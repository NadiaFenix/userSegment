# Описание задачи и используемые технологии


Сервис, хранящий пользователя и сегменты, в которых он состоит (создание, изменение, удаление сегментов, а также добавление и удаление пользователей в сегмент)

Используемые технологии:
- MySQL (в качестве хранилища данных)
- Docker (для запуска сервиса)
- "database/sql" (является пакетом для работы с базами данных)
- "encoding/json" (преобразования данных в формат JSON и обратно)
- "log" ( функции для записи логов)
- "net/http" (функциональность для работы с HTTP протоколом, включая создание HTTP серверов и клиентов)
- "github.com/gorilla/mux" ( маршрутизатор для создания веб-приложений в Go)
- _ "github.com/go-sql-driver/mysql" (импортирует драйвер базы данных для работы с MySQL)



# Запуск

Запустите сервис с помощью команды docker-compose up --build. 

После запуска вы сможете делать запросы к сервису по адресу http://localhost:8000. Например:

## Пример использования

Некоторые примеры запросов
- [Создание сегмента](#createSegment)
- [Удаление сегмента](#deleteSegment)
- [Добавление пользователя в сегмент](#addUserToSegment)
- [Получение активных сегментов пользователя](#getActiveSegments)


### Создание сегмента <a name="createSegment"></a>

Создание сегмента:
```
curl -X POST -H "Content-Type: application/json" -d '{"slug":"AVITO_VOICE_MESSAGES"}' http://localhost:8000/segments 

```


### Удаление сегмента <a name="deleteSegment"></a>

Удаление сегмента:
```
curl --location --request POST 'http://curl -X DELETE http://localhost:8000/segments/AVITO_PERFORMANCE_VAS
```


### Добавление пользователя в сегмент <a name="addUserToSegment"></a>

Добавление пользователя в сегмент:
```
curl -X PUT -H "Content-Type: application/json" -d '{"add":["AVITO_VOICE_MESSAGES","AVITO_PERFORMANCE_VAS"],"remove":["AVITO_DISCOUNT_30"]}' http://localhost:8000/users/user-1/segments
```

### Получение активных сегментов пользователя <a name="getActiveSegments"></a>

Получение активных сегментов пользователя:
```
curl http://localhost:8000/users/segments/user-1
```

# Описание работы программного кода

>программный код представляет собой простое веб-приложение на языке Go, которое работает с базой данных MySQL.

>Вначале идет объявление необходимых пакетов и импортов. Затем следуют определения двух структур данных: Segment и User. Структура Segment содержит поле Slug, а структура User содержит поле ID и слайс с сегментами Segments.

>Затем идут объявления переменных, включая переменную db, которая представляет собой указатель на объект sql.DB, используемый для установления соединения с базой данных.

>Главная функция main начинается с установки соединения с базой данных. 

>Далее следуют два вызова db.Exec(), которые создают таблицы в базе данных для пользователей и сегментов, если они еще не существуют.

>Затем инициализируется роутер с помощью функции mux.NewRouter() из пакета gorilla/mux.Роутеру устанавливаются обработчики для нескольких HTTP-запросов, которые определены как функции внутри пакета main: createSegment, deleteSegment, addUserToSegment и getActiveSegments.

>createSegment обрабатывает HTTP POST-запросы на путь "/segments" и позволяет создавать новые сегменты, вставляя их в базу данных.

>deleteSegment обрабатывает HTTP DELETE-запросы на путь "/segments/{slug}" и удаляет сегмент с указанным slug из базы данных.

>addUserToSegment обрабатывает HTTP PUT-запросы на путь "/users/{id}/segments" и добавляет или удаляет сегменты из списка сегментов пользователя в базе данных, в зависимости от данных, полученных от запроса.

>getActiveSegments обрабатывает HTTP GET-запросы на путь "/users/segments/{id}" и возвращает список активных сегментов для пользователя с указанным id.

>В конце главной функции вызывается функция http.ListenAndServe() для запуска HTTP сервера, который прослушивает порт 8000 и маршрутизирует входящие запросы с помощью роутера.

>В результате, приложение предоставляет несколько эндпоинтов для работы с данными о сегментах и пользователях, используя базу данных MySQL.
